/*! For license information please see 111.bundle.a663acf1e7f9891be285.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{1400:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=g(a(119)),s=g(a(115)),o=g(a(116)),r=g(a(120)),l=g(a(121)),i=a(123),c=g(i),p=a(134),u=a(204),d=a(114),m=a(137),C=a(143),h=a(146);function g(e){return e&&e.__esModule?e:{default:e}}var k=function(e){function t(e){(0,s.default)(this,t);var a=(0,r.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e)),o=a,l=document.createElement("div"),i=document.createElement("button"),c=(0,C.getLanguage)(e.mapController.data);i.title=c.CTRL_PERMALINK,l.className="c4g-permalink-control ol-unselectable ol-control ",e.open?l.className+="c4g-open":l.className+="c4g-close",e.external&&(l.className+=" c4g-external"),l.appendChild(i),jQuery(l).on("click",(function(e){o.state.open?o.close():o.open()}));var p=e.mapController,u=new h.Control({element:l,target:e.target});return p.mapsControls.controls.horizontalPanel=u,p.map.addControl(u),a.open=a.open.bind(a),a.close=a.close.bind(a),a.langConstants=(0,C.getLanguage)(a.props.mapController.data),a.state={open:!1,link:""},a}return(0,l.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){var e=this;return c.default.createElement("div",{className:"c4g-permalink-wrapper"},c.default.createElement(u.Titlebar,{wrapperClass:"c4g-permalink-header",headerClass:"c4g-permalink-header-headline",header:"Permalink",closeBtnClass:"c4g-permalink-close",closeBtnCb:this.close,closeBtnTitle:this.langConstants.CLOSE}),c.default.createElement("div",{className:"c4g-permalink-content"},c.default.createElement("textarea",{cols:"50",rows:"2",id:"permalink-text",value:this.state.link,readOnly:!0}),c.default.createElement("button",{className:p.cssConstants.COPY+" "+p.cssConstants.ICON,title:this.langConstants.COPY_TO_CLIPBOARD,"data-clipboard-target":"#permalink-text"}),c.default.createElement("button",{className:p.cssConstants.REFRESH+" "+p.cssConstants.ICON,title:this.langConstants.REFRESH,onMouseUp:function(){return e.generateLinkFromCurrentState({target:e.textfield})}})))}},{key:"componentDidUpdate",value:function(e,t,a){(t.open===this.state.open&&t.link===this.state.link||this.generateLinkFromCurrentState({target:this.textfield}),t.open&&!this.state.open&&jQuery(".c4g-permalink-container").removeClass(p.cssConstants.OPEN).addClass(p.cssConstants.CLOSE),this.props.mapController.data.caching&&!this.state.open)&&(m.utils.getValue("panel")===this.constructor.name&&m.utils.storeValue("panel",""));this.state.open&&jQuery(".c4g-permalink-container").addClass(p.cssConstants.OPEN).removeClass(p.cssConstants.CLOSE)}},{key:"componentDidMount",value:function(){this.textField=document.querySelector("#permalink-text");var e=document.querySelector("."+p.cssConstants.COPY+"."+p.cssConstants.ICON);try{new ClipboardJS(e)}catch(e){console.warn("Permalink is currently not supported in backend mode..")}}},{key:"open",value:function(){jQuery(this.element).addClass(p.cssConstants.OPEN),jQuery(".c4g-permalink-container").removeClass(p.cssConstants.CLOSE).addClass(p.cssConstants.OPEN),this.setState({open:!0}),this.props.mapController.setOpenComponent(this)}},{key:"close",value:function(){jQuery(this.element).removeClass(p.cssConstants.OPEN),jQuery(".c4g-permalink-container").removeClass(p.cssConstants.OPEN).addClass(p.cssConstants.CLOSE),this.setState({open:!1})}},{key:"toggle",value:function(){jQuery(this.popup).hasClass(p.cssConstants.CLOSE)?this.open():this.close()}},{key:"generateLinkFromCurrentState",value:function(e){var t,a,n,s,o,r;(!(t=e||{}).paramCount||6!==t.paramCount&&2!==t.paramCount&&1!==t.paramCount)&&(t.paramCount=6),s=[],n=this.props.mapController.map.getView(),a=this.props.mapController.proxy,r=n.getCenter(),r=(0,d.transform)([r[0],r[1]],"EPSG:3857","EPSG:4326"),s.push(+r[0].toFixed(6)),s.push(+r[1].toFixed(5)),s.push(n.getZoom()),s.push(+n.getRotation().toFixed(2)),a.activeBaselayerId?s.push(a.activeBaselayerId):s.push(0);var l=[],i=this.props.mapController.state.arrLayerStates;for(var c in i)i.hasOwnProperty(c)&&(l=l.concat(this.getActiveLayerIds(i[c])));l=l.length>1?(l=m.utils.deltaEncode(l)).join(":"):l[0]||"0",s.push(l),s=s.join("/"),o=m.utils.setUrlParam(s,this.props.mapController.data.permalink.getParameter),this.setState({link:o})}},{key:"generateLink",value:function(e){return!(!e||6!==e.length&&2!==e.length&&1!==e.length)&&m.utils.setUrlParam(e.join("/"),this.props.mapController.data.permalink.getParameter)}},{key:"getActiveLayerIds",value:function(e){var t=[];for(var a in e.active&&t.push(e.id),e.childStates)e.childStates.hasOwnProperty(a)&&(t=t.concat(this.getActiveLayerIds(e.childStates[a])));return t}}]),t}(i.Component);t.default=k}}]);