(self.webpackChunkframeworkbundle=self.webpackChunkframeworkbundle||[]).push([[2745,6516],{56516:(e,t,a)=>{"use strict";var r=a(95318),i=a(50008);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(a(87757)),l=r(a(48926)),o=r(a(34575)),s=r(a(93913)),p=r(a(81506)),u=r(a(2205)),f=r(a(78585)),d=r(a(29754)),c=r(a(59713)),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var a=y(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var o=n?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(r,l,o):r[l]=e[l]}r.default=e,a&&a.set(e,r);return r}(a(67294)),m=r(a(96120));a(53719);var g=r(a(86455)),v=r(a(49303));function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(y=function(e){return e?a:t})(e)}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,r=(0,d.default)(e);if(t){var i=(0,d.default)(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return(0,f.default)(this,a)}}var b=function(e){(0,u.default)(i,e);var t,a,r=C(i);function i(e){var t;return(0,o.default)(this,i),t=r.call(this,e),(0,c.default)((0,p.default)(t),"onSelectFile",(function(e){if(e.target.files&&e.target.files.length>0){e.target.files[0].name;if(t.checkFileSize(e.target.files[0])){if(t.allowedFileTypes.includes(e.target.files[0].type)){var a=e.target.files[0].name,r=e.target.files[0].type;(0,v.default)(e.target.files[0],(function(e){var i=e.toDataURL(r);t.setState({src:i,imageName:a})}),{orientation:!0,canvas:!0})}}else g.default.fire({icon:"error",title:t.props.field.titleFileTooBig,text:t.props.field.textFileTooBig}),e.target.value=""}})),(0,c.default)((0,p.default)(t),"onImageLoaded",(function(e){t.imageRef=e;var a=JSON.parse(JSON.stringify(t.state.crop));if(t.props.data[t.props.field.name]){var r=t.props.data[t.props.field.name].importantPart;return r||(r={x:.05,y:.05,height:.9,width:.9}),a.x=r.x*t.imageRef.width,a.y=r.y*t.imageRef.height,a.width=r.width*t.imageRef.width,a.height=r.height*t.imageRef.height,a.unit="px",t.setState({crop:a},(function(){return t.onCropComplete(a)})),!1}})),(0,c.default)((0,p.default)(t),"onCropChange",(function(e,a){t.setState({crop:a})})),t.getCroppedImg=t.getCroppedImg.bind((0,p.default)(t)),t.onSelectFile=t.onSelectFile.bind((0,p.default)(t)),t.onImageLoaded=t.onImageLoaded.bind((0,p.default)(t)),t.onCropComplete=t.onCropComplete.bind((0,p.default)(t)),t.makeClientCrop=t.makeClientCrop.bind((0,p.default)(t)),t.onCropChange=t.onCropChange.bind((0,p.default)(t)),t.unsetImage=t.unsetImage.bind((0,p.default)(t)),t.state={src:null,imageName:"",crop:{unit:"%",width:90,height:90,x:5,y:5},croppedImageUrl:null},t.props.data[t.props.field.name]&&(t.state.src=t.props.data[t.props.field.name].path,t.state.imageName=t.props.data[t.props.field.name].name),t.inputRef=null,t.allowedFileTypes=["image/png","image/jpeg","image/jpg"],t}return(0,s.default)(i,[{key:"checkFileSize",value:function(e){var t,a=e.size;return!(a>1e3&&(t=a/1e3)>1e3&&t/1e3>6)}},{key:"onCropComplete",value:(a=(0,l.default)(n.default.mark((function e(t){var a,r;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.makeClientCrop(t);case 2:a={imageData:this.state.src,importantPart:{x:t.x/this.imageRef.width,y:t.y/this.imageRef.height,width:t.width/this.imageRef.width,height:t.height/this.imageRef.height},imageName:this.state.imageName},(r=this.props.data)[this.props.field.name]=a,this.props.form.props.updateFunction(this.props.form.props.name,r),jQuery.post(this.props.field.uploadUrl,{image:a,childId:r.uuid}).done((function(e){}));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"makeClientCrop",value:(t=(0,l.default)(n.default.mark((function e(t){var a;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.imageRef&&t.width&&t.height)){e.next=5;break}return e.next=3,this.getCroppedImg(this.imageRef,t,"newFile.jpeg");case 3:a=e.sent,this.setState({croppedImageUrl:a});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getCroppedImg",value:function(e,t,a){var r=document.createElement("canvas"),i=e.naturalWidth/e.width,n=e.naturalHeight/e.height;return r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(e,t.x*i,t.y*n,t.width*i,t.height*n,0,0,t.width,t.height),r.toDataURL("image/jpeg")}},{key:"render",value:function(){var e=this,t=null;this.props.field.label&&(t=this.props.field.required?h.default.createElement("label",{className:"label-file c4g-required"},this.props.field.label):h.default.createElement("label",{className:"label-file"},this.props.field.label));var a=this.state,r=a.crop,i=a.croppedImageUrl,n=a.src,l=this.props.field.name,o=null;this.props.field.description&&(o=h.default.createElement("small",{className:"field-description form-text text-muted"},this.props.field.description));var s=null;return n&&(s=(s=n.split("/"))[s.length-1]),h.default.createElement(h.default.Fragment,null,h.default.createElement("div",{className:"form-group"},t,h.default.createElement("input",{type:"file",accept:".jpg, .png, .jpeg",onChange:this.onSelectFile,id:l,className:"form-control-file",ref:function(t){e.inputRef=t},required:this.props.field.required&&!i}),s&&h.default.createElement("input",{type:"hidden",name:l,value:s}),o),n&&h.default.createElement(m.default,{src:n,crop:r,ruleOfThirds:!0,onImageLoaded:this.onImageLoaded,onComplete:this.onCropComplete,onChange:this.onCropChange}),i&&h.default.createElement("img",{alt:"Crop",style:{maxWidth:"100%"},src:i}),n&&h.default.createElement("button",{onClick:this.unsetImage,title:this.props.languageRefs.CLICK_TO_REMOVE_IMAGE,className:"btn btn-primary remove-image "+this.props.field.name},this.props.languageRefs.REMOVE_IMAGE))}},{key:"unsetImage",value:function(){var e=this.props.data;e[this.props.field.name]=null,this.setState({src:null,imageName:null,crop:null,croppedImageUrl:null}),this.inputRef&&(this.inputRef.value=""),this.props.form.props.updateFunction(this.props.form.props.name,e);var t={uuid:e.uuid,fieldName:this.props.field.name};jQuery.post(this.props.field.removeImageUrl,t).done((function(e){}))}}]),i}(h.Component);t.default=b},42745:(e,t,a)=>{"use strict";var r=a(95318),i=a(50008);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(a(59713)),l=r(a(34575)),o=r(a(93913)),s=r(a(81506)),p=r(a(2205)),u=r(a(78585)),f=r(a(29754)),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var a=h(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var o=n?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(r,l,o):r[l]=e[l]}r.default=e,a&&a.set(e,r);return r}(a(67294)),c=r(a(56516));function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(h=function(e){return e?a:t})(e)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,r=(0,f.default)(e);if(t){var i=(0,f.default)(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return(0,u.default)(this,a)}}var g=function(e){(0,p.default)(a,e);var t=m(a);function a(e){var r;return(0,l.default)(this,a),(r=t.call(this,e)).handleChange=r.handleChange.bind((0,s.default)(r)),r}return(0,o.default)(a,[{key:"handleChange",value:function(e){this.props.form.props.updateFunction(this.props.form.props.name,(0,n.default)({},this.props.field.name,e.target.value))}},{key:"render",value:function(){var e=this,t=null;this.props.field.label&&(t=d.default.createElement(d.default.Fragment,null,d.default.createElement("label",{htmlFor:this.props.field.name,required:this.props.field.required},this.props.field.label)));var a=null;this.props.field.label&&(a=d.default.createElement("span",{className:"field-description"},this.props.field.description));for(var r=[],i=0;i<this.props.field.maxImages;i++)this.props.data[this.props.field.name+"_"+i]?r.push(this.props.data[this.props.field.name+"_"+i]):r.push({});return d.default.createElement("div",{className:(this.props.field.className?this.props.field.className+" ":"")+"c4g-form-field"},t,r.map((function(t,a){var r=JSON.parse(JSON.stringify(e.props.field));return r.label="",r.name=r.name+"_"+a,d.default.createElement(c.default,{key:a,data:e.props.data,field:r,form:e.props.form,languageRefs:e.props.languageRefs})})),a)}}]),a}(d.Component);t.default=g}}]);