/*! For license information please see 42.bundle.b2de19a8a45f2560f1eb.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[42,75],{1218:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(a(53)),r=h(a(51)),l=h(a(45)),n=h(a(46)),s=h(a(47)),p=h(a(48)),o=h(a(49)),d=a(17),u=h(d),f=h(a(501));function h(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(e){(0,n.default)(this,t);var a=(0,p.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e));return a.handleChange=a.handleChange.bind(a),a}return(0,o.default)(t,e),(0,s.default)(t,[{key:"handleChange",value:function(e){this.props.form.props.updateFunction(this.props.form.props.name,(0,r.default)({},this.props.field.name,e.target.value))}},{key:"render",value:function(){var e=this,t=null;this.props.field.label&&(t=u.default.createElement(u.default.Fragment,null,u.default.createElement("label",{htmlFor:this.props.field.name,required:this.props.field.required},this.props.field.label)));var a=null;this.props.field.label&&(a=u.default.createElement("span",{className:"field-description"},this.props.field.description));for(var r=[],l=0;l<this.props.field.maxImages;l++)this.props.data[this.props.field.name+"_"+l]?r.push(this.props.data[this.props.field.name+"_"+l]):r.push({});return u.default.createElement("div",{className:(this.props.field.className?this.props.field.className+" ":"")+"c4g-form-field"},t,r.map((function(t,a){var r=JSON.parse((0,i.default)(e.props.field));return r.label="",r.name=r.name+"_"+a,u.default.createElement(f.default,{key:a,data:e.props.data,field:r,form:e.props.form,languageRefs:e.props.languageRefs})})),a)}}]),t}(d.Component);t.default=m},501:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=g(a(495)),r=g(a(496)),l=g(a(53)),n=g(a(45)),s=g(a(46)),p=g(a(47)),o=g(a(48)),d=g(a(49)),u=a(17),f=g(u),h=g(a(498));a(499);var m=g(a(270)),c=g(a(500));function g(e){return e&&e.__esModule?e:{default:e}}var v=function(e){function t(e){(0,s.default)(this,t);var a=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return a.onSelectFile=function(e){if(e.target.files&&e.target.files.length>0){e.target.files[0].name;if(a.checkFileSize(e.target.files[0])){if(a.allowedFileTypes.includes(e.target.files[0].type)){var t=e.target.files[0].name,i=e.target.files[0].type;(0,c.default)(e.target.files[0],(function(e){var r=e.toDataURL(i);a.setState({src:r,imageName:t})}),{orientation:!0,canvas:!0})}}else m.default.fire({icon:"error",title:a.props.field.titleFileTooBig,text:a.props.field.textFileTooBig}),e.target.value=""}},a.onImageLoaded=function(e){a.imageRef=e;var t=JSON.parse((0,l.default)(a.state.crop));if(a.props.data[a.props.field.name]){var i=a.props.data[a.props.field.name].importantPart;return i||(i={x:.05,y:.05,height:.9,width:.9}),t.x=i.x*a.imageRef.width,t.y=i.y*a.imageRef.height,t.width=i.width*a.imageRef.width,t.height=i.height*a.imageRef.height,t.unit="px",a.setState({crop:t},(function(){return a.onCropComplete(t)})),!1}},a.onCropChange=function(e,t){a.setState({crop:t})},a.getCroppedImg=a.getCroppedImg.bind(a),a.onSelectFile=a.onSelectFile.bind(a),a.onImageLoaded=a.onImageLoaded.bind(a),a.onCropComplete=a.onCropComplete.bind(a),a.makeClientCrop=a.makeClientCrop.bind(a),a.onCropChange=a.onCropChange.bind(a),a.unsetImage=a.unsetImage.bind(a),a.state={src:null,imageName:"",crop:{unit:"%",width:90,height:90,x:5,y:5},croppedImageUrl:null},a.props.data[a.props.field.name]&&(a.state.src=a.props.data[a.props.field.name].path,a.state.imageName=a.props.data[a.props.field.name].name),a.inputRef=null,a.allowedFileTypes=["image/png","image/jpeg","image/jpg"],a}var a,u;return(0,d.default)(t,e),(0,p.default)(t,[{key:"checkFileSize",value:function(e){var t=e.size,a=void 0;return!(t>1e3&&(a=t/1e3)>1e3&&a/1e3>6)}},{key:"onCropComplete",value:(u=(0,r.default)(i.default.mark((function e(t){var a,r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.makeClientCrop(t);case 2:a={imageData:this.state.src,importantPart:{x:t.x/this.imageRef.width,y:t.y/this.imageRef.height,width:t.width/this.imageRef.width,height:t.height/this.imageRef.height},imageName:this.state.imageName},(r=this.props.data)[this.props.field.name]=a,this.props.form.props.updateFunction(this.props.form.props.name,r),jQuery.post(this.props.field.uploadUrl,{image:a,childId:r.uuid}).done((function(e){}));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"makeClientCrop",value:(a=(0,r.default)(i.default.mark((function e(t){var a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.imageRef&&t.width&&t.height)){e.next=5;break}return e.next=3,this.getCroppedImg(this.imageRef,t,"newFile.jpeg");case 3:a=e.sent,this.setState({croppedImageUrl:a});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getCroppedImg",value:function(e,t,a){var i=document.createElement("canvas"),r=e.naturalWidth/e.width,l=e.naturalHeight/e.height;return i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(e,t.x*r,t.y*l,t.width*r,t.height*l,0,0,t.width,t.height),i.toDataURL("image/jpeg")}},{key:"render",value:function(){var e=this,t=null;this.props.field.label&&(t=this.props.field.required?f.default.createElement("label",{className:"label-file c4g-required"},this.props.field.label):f.default.createElement("label",{className:"label-file"},this.props.field.label));var a=this.state,i=a.crop,r=a.croppedImageUrl,l=a.src,n=this.props.field.name,s=null;this.props.field.description&&(s=f.default.createElement("small",{className:"field-description form-text text-muted"},this.props.field.description));var p=null;return l&&(p=(p=l.split("/"))[p.length-1]),f.default.createElement(f.default.Fragment,null,f.default.createElement("div",{className:"form-group"},t,f.default.createElement("input",{type:"file",accept:".jpg, .png, .jpeg",onChange:this.onSelectFile,id:n,className:"form-control-file",ref:function(t){e.inputRef=t},required:this.props.field.required&&!r}),p&&f.default.createElement("input",{type:"hidden",name:n,value:p}),s),l&&f.default.createElement(h.default,{src:l,crop:i,ruleOfThirds:!0,onImageLoaded:this.onImageLoaded,onComplete:this.onCropComplete,onChange:this.onCropChange}),r&&f.default.createElement("img",{alt:"Crop",style:{maxWidth:"100%"},src:r}),l&&f.default.createElement("button",{onClick:this.unsetImage,title:this.props.languageRefs.CLICK_TO_REMOVE_IMAGE,className:"btn btn-primary remove-image "+this.props.field.name},this.props.languageRefs.REMOVE_IMAGE))}},{key:"unsetImage",value:function(){var e=this.props.data;e[this.props.field.name]=null,this.setState({src:null,imageName:null,crop:null,croppedImageUrl:null}),this.inputRef&&(this.inputRef.value=""),this.props.form.props.updateFunction(this.props.form.props.name,e);var t={uuid:e.uuid,fieldName:this.props.field.name};jQuery.post(this.props.field.removeImageUrl,t).done((function(e){}))}}]),t}(u.Component);t.default=v}}]);