/*! For license information please see 8874.bundle.ed5244e9e6b51f28b9c9.js.LICENSE.txt */
"use strict";(self.webpackChunkframeworkbundle=self.webpackChunkframeworkbundle||[]).push([[8874],{28874:(e,t,a)=>{var i=a(24994),r=a(73738);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(a(54756)),l=i(a(29293)),o=i(a(17383)),p=i(a(34579)),s=i(a(28452)),u=i(a(63072)),f=i(a(29511)),d=i(a(43693)),h=function(e,t){if("function"==typeof WeakMap)var a=new WeakMap,i=new WeakMap;return function(e,t){if(!t&&e&&e.__esModule)return e;var n,l,o={__proto__:null,default:e};if(null===e||"object"!=r(e)&&"function"!=typeof e)return o;if(n=t?i:a){if(n.has(e))return n.get(e);n.set(e,o)}for(var p in e)"default"!==p&&{}.hasOwnProperty.call(e,p)&&((l=(n=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,p))&&(l.get||l.set)?n(o,p,l):o[p]=e[p]);return o}(e,t)}(a(96540)),c=i(a(98093));a(92461);var m=i(a(78465)),g=i(a(58202));function v(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(v=function(){return!!e})()}t.default=function(e){function t(e){var a,i,r,n;return(0,o.default)(this,t),i=this,r=t,n=[e],r=(0,u.default)(r),a=(0,s.default)(i,v()?Reflect.construct(r,n||[],(0,u.default)(i).constructor):r.apply(i,n)),(0,d.default)(a,"onSelectFile",function(e){if(e.target.files&&e.target.files.length>0){e.target.files[0].name;if(a.checkFileSize(e.target.files[0])){if(a.allowedFileTypes.includes(e.target.files[0].type)){var t=e.target.files[0].name,i=e.target.files[0].type;(0,g.default)(e.target.files[0],function(e){var r=e.toDataURL(i);a.setState({src:r,imageName:t})},{orientation:!0,canvas:!0})}}else m.default.fire({icon:"error",title:a.props.field.titleFileTooBig,text:a.props.field.textFileTooBig}),e.target.value=""}}),(0,d.default)(a,"onImageLoaded",function(e){a.imageRef=e;var t=JSON.parse(JSON.stringify(a.state.crop));if(a.props.data[a.props.field.name]){var i=a.props.data[a.props.field.name].importantPart;return i||(i={x:.05,y:.05,height:.9,width:.9}),t.x=i.x*a.imageRef.width,t.y=i.y*a.imageRef.height,t.width=i.width*a.imageRef.width,t.height=i.height*a.imageRef.height,t.unit="px",a.setState({crop:t},function(){return a.onCropComplete(t)}),!1}}),(0,d.default)(a,"onCropChange",function(e,t){a.setState({crop:t})}),a.getCroppedImg=a.getCroppedImg.bind(a),a.onSelectFile=a.onSelectFile.bind(a),a.onImageLoaded=a.onImageLoaded.bind(a),a.onCropComplete=a.onCropComplete.bind(a),a.makeClientCrop=a.makeClientCrop.bind(a),a.onCropChange=a.onCropChange.bind(a),a.unsetImage=a.unsetImage.bind(a),a.state={src:null,imageName:"",crop:{unit:"%",width:90,height:90,x:5,y:5},croppedImageUrl:null},a.props.data[a.props.field.name]&&(a.state.src=a.props.data[a.props.field.name].path,a.state.imageName=a.props.data[a.props.field.name].name),a.inputRef=null,a.allowedFileTypes=["image/png","image/jpeg","image/jpg"],a}return(0,f.default)(t,e),(0,p.default)(t,[{key:"checkFileSize",value:function(e){var t,a=e.size;return!(a>1e3&&(t=a/1e3)>1e3&&t/1e3>6)}},{key:"onCropComplete",value:(i=(0,l.default)(n.default.mark(function e(t){var a,i;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.makeClientCrop(t);case 1:a={imageData:this.state.src,importantPart:{x:t.x/this.imageRef.width,y:t.y/this.imageRef.height,width:t.width/this.imageRef.width,height:t.height/this.imageRef.height},imageName:this.state.imageName},(i=this.props.data)[this.props.field.name]=a,this.props.form.props.updateFunction(this.props.form.props.name,i,this.props.field),jQuery.post(this.props.field.uploadUrl,{image:a,childId:i.uuid}).done(function(e){});case 2:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"makeClientCrop",value:(a=(0,l.default)(n.default.mark(function e(t){var a;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.imageRef&&t.width&&t.height)){e.next=2;break}return e.next=1,this.getCroppedImg(this.imageRef,t,"newFile.jpeg");case 1:a=e.sent,this.setState({croppedImageUrl:a});case 2:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"getCroppedImg",value:function(e,t,a){var i=document.createElement("canvas"),r=e.naturalWidth/e.width,n=e.naturalHeight/e.height;return i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(e,t.x*r,t.y*n,t.width*r,t.height*n,0,0,t.width,t.height),i.toDataURL("image/jpeg")}},{key:"render",value:function(){var e=this,t=null;this.props.field.label&&(t=this.props.field.required?h.default.createElement("label",{className:"label-file c4g-required"},this.props.field.label):h.default.createElement("label",{className:"label-file"},this.props.field.label));var a=this.state,i=a.crop,r=a.croppedImageUrl,n=a.src,l=this.props.field.name,o=null;this.props.field.description&&(o=h.default.createElement("small",{className:"field-description form-text text-muted"},this.props.field.description));var p=null;return n&&(p=(p=n.split("/"))[p.length-1]),h.default.createElement(h.default.Fragment,null,h.default.createElement("div",{className:"form-group"},t,h.default.createElement("input",{type:"file",accept:".jpg, .png, .jpeg",onChange:this.onSelectFile,id:l,className:"form-control-file",ref:function(t){e.inputRef=t},required:this.props.field.required&&!r}),p&&h.default.createElement("input",{type:"hidden",name:l,value:p}),o),n&&h.default.createElement(c.default,{src:n,crop:i,ruleOfThirds:!0,onImageLoaded:this.onImageLoaded,onComplete:this.onCropComplete,onChange:this.onCropChange}),r&&h.default.createElement("img",{alt:"Crop",style:{maxWidth:"100%"},src:r}),n&&h.default.createElement("button",{onClick:this.unsetImage,title:this.props.languageRefs.CLICK_TO_REMOVE_IMAGE,className:"btn btn-primary btn-remove remove-image "+this.props.field.name},this.props.languageRefs.REMOVE_IMAGE))}},{key:"unsetImage",value:function(){var e=this.props.data;e[this.props.field.name]=null,this.setState({src:null,imageName:null,crop:null,croppedImageUrl:null}),this.inputRef&&(this.inputRef.value=""),this.props.form.props.updateFunction(this.props.form.props.name,e,this.props.field);var t={uuid:e.uuid,fieldName:this.props.field.name};jQuery.post(this.props.field.removeImageUrl,t).done(function(e){})}}]);var a,i}(h.Component)}}]);